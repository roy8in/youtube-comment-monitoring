<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>NPS ì—¬ë¡  ëª¨ë‹ˆí„°ë§</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .card { margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4">ğŸ“Š êµ­ë¯¼ì—°ê¸ˆ ìœ íŠœë¸Œ ì—¬ë¡  ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h2>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card p-3"><div id="viewChart"></div></div>
            </div>
            <div class="col-md-6">
                <div class="card p-3"><div id="sentimentChart"></div></div>
            </div>
            <div class="col-md-6">
                <div class="card p-3"><div id="keywordChart"></div></div>
            </div>
        </div>

        <div class="card p-3">
            <h4>ğŸ“ ìµœê·¼ ë¶„ì„ ë°ì´í„°</h4>
            <div class="table-responsive">
                <table class="table table-hover" id="dataTable">
                    <thead><tr><th>ê°ì„±</th><th>í‚¤ì›Œë“œ</th><th>ë‚´ìš©</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 1. ì˜ìƒ í†µê³„ ì°¨íŠ¸ (ì¡°íšŒìˆ˜ ì¶”ì´)
        Papa.parse("video_stats.csv", {
            download: true, header: true, complete: function(results) {
                const data = results.data.filter(d => d.timestamp);
                const trace = {
                    x: data.map(d => d.timestamp),
                    y: data.map(d => d.view_count),
                    type: 'scatter', mode: 'lines+markers', name: 'ì¡°íšŒìˆ˜',
                    line: {color: '#FF4B4B'}
                };
                Plotly.newPlot('viewChart', [trace], {title: 'ì‹œê°„ëŒ€ë³„ ëˆ„ì  ì¡°íšŒìˆ˜ ì¶”ì´'});
            }
        });

        // 2. ê°ì„± ë¶„ì„ ë° í‘œ ì—…ë°ì´íŠ¸
        Papa.parse("analyzed_comments.csv", {
            download: true, header: true, complete: function(results) {
                const data = results.data.filter(d => d.sentiment);
                
                // ê°ì„± íŒŒì´ ì°¨íŠ¸
                const counts = {};
                data.forEach(d => counts[d.sentiment] = (counts[d.sentiment] || 0) + 1);
                const pieData = [{
                    values: Object.values(counts),
                    labels: Object.keys(counts),
                    type: 'pie',
                    marker: {colors: ['#00CC96', '#EF553B', '#636EFA']}
                }];
                Plotly.newPlot('sentimentChart', pieData, {title: 'ì „ì²´ ê°ì„± ë¶„í¬'});

                // í‘œ ì—…ë°ì´íŠ¸ (ìµœê·¼ ìˆœ)
                const tbody = document.querySelector("#dataTable tbody");
                data.reverse().slice(0, 20).forEach(d => {
                    const row = `<tr>
                        <td style="color:${d.sentiment === 'ê¸ì •' ? '#00CC96' : '#EF553B'}"><b>${d.sentiment}</b></td>
                        <td>${d.keyword}</td>
                        <td class="small">${d.text}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
            }
        });
    </script>
</body>
</html>